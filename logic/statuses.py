from typing import List, TYPE_CHECKING

if TYPE_CHECKING:
    from core.models import Unit


class StatusManager:
    @staticmethod
    def process_turn_end(unit: 'Unit') -> List[str]:
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ –∫–æ–Ω—Ü–µ —Ä–∞—É–Ω–¥–∞ (–Ω–∞–Ω–µ—Å–µ–Ω–∏–µ DOT-—É—Ä–æ–Ω–∞, —Å–Ω—è—Ç–∏–µ –±–∞—Ñ—Ñ–æ–≤).
        """
        logs = []

        # --- 1. –ì–æ—Ä–µ–Ω–∏–µ (Burn) ---
        # –ù–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω –≤ –∫–æ–Ω—Ü–µ —Ö–æ–¥–∞ –∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1/3 (–∏–ª–∏ –ø–æ–ª–æ–≤–∏–Ω—É, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ –ø—Ä–∞–≤–∏–ª)
        burn = unit.get_status("burn")
        if burn > 0:
            dmg = burn
            unit.current_hp -= dmg
            # –í LoR –≥–æ—Ä–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ —Ç–µ—Ä—è–µ—Ç —á–∞—Å—Ç—å —Å—Ç–∞–∫–æ–≤, –∞ –Ω–µ –≤—Å–µ
            unit.remove_status("burn", burn // 3)
            logs.append(f"üî• Burn: {unit.name} takes {dmg} dmg")

        # --- 2. –°–æ—Ç—Ä—è—Å–µ–Ω–∏–µ (Tremor) ---
        # –û–±—ã—á–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–æ—Ä–æ–≥ –æ–≥–ª—É—à–µ–Ω–∏—è, —Å–∞–º–æ –ø–æ —Å–µ–±–µ –Ω–µ –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω HP.
        # –°–ø–∞–¥–∞–µ—Ç –≤ –∫–æ–Ω—Ü–µ —Ö–æ–¥–∞, –µ—Å–ª–∏ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ.
        if unit.get_status("tremor") > 0:
            unit.remove_status("tremor")  # –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –∏–ª–∏ decay

        # --- 3. –°–∞–º–æ–æ–±–ª–∞–¥–∞–Ω–∏–µ (Poise) ---
        # –¢–µ—Ä—è–µ—Ç 20% –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        poise = unit.get_status("poise")
        if poise > 0:
            loss = max(1, int(poise * 0.2))
            unit.remove_status("poise", loss)

        # --- 4. –ó–∞—Ä—è–¥ (Charge) ---
        # –¢–µ—Ä—è–µ—Ç 1 –∑–∞—Ä—è–¥ –∫–∞–∂–¥—ã–π —Ö–æ–¥
        charge = unit.get_status("charge")
        if charge > 0:
            unit.remove_status("charge", 1)

        # --- 5. –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ (Bleed) ---
        # –í–ê–ñ–ù–û: –ö—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –≤ LoR –¥–µ–π—Å—Ç–≤—É–µ—Ç –æ–¥–Ω—É —Å—Ü–µ–Ω—É.
        # –ï—Å–ª–∏ —é–Ω–∏—Ç –Ω–µ –∞—Ç–∞–∫–æ–≤–∞–ª (–Ω–µ –∏—Å—Ç—Ä–∞—Ç–∏–ª —Å—Ç–∞–∫–∏), –æ–Ω–∏ —Å–≥–æ—Ä–∞—é—Ç –≤ –∫–æ–Ω—Ü–µ —Ö–æ–¥–∞.
        if unit.get_status("bleed") > 0:
            unit.remove_status("bleed")
            # –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –∫—Ä–æ–≤–æ—Ç–µ—á–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å (–∫–∞–∫ –≤ Darkest Dungeon),
            # –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –≤—ã—à–µ. –ù–æ –ø–æ –∫–∞–Ω–æ–Ω—É LoR –æ–Ω–æ –∏—Å—á–µ–∑–∞–µ—Ç.

        # --- 6. –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –±–∞—Ñ—Ñ–æ–≤/–¥–µ–±–∞—Ñ—Ñ–æ–≤ ---
        # –≠—Ç–∏ —Å—Ç–∞—Ç—É—Å—ã –¥–µ–π—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ 1 —Ä–∞—É–Ω–¥ (Scene)
        temp_stats = [
            "strength", "weakness",  # –°–∏–ª–∞ / –°–ª–∞–±–æ—Å—Ç—å
            "endurance", "disarm",  # –°—Ç–æ–π–∫–æ—Å—Ç—å / –†–∞–∑–æ—Ä—É–∂–µ–Ω–∏–µ
            "haste", "slow",  # –°–∫–æ—Ä–æ—Å—Ç—å
            "protection", "fragile",  # –ó–∞—â–∏—Ç–∞ / –•—Ä—É–ø–∫–æ—Å—Ç—å
            "dmg_up", "dmg_down",  # –ë–æ–Ω—É—Å—ã —É—Ä–æ–Ω–∞
            "paralysis", "bind",  # –ü–∞—Ä–∞–ª–∏—á, –°–≤—è–∑—ã–≤–∞–Ω–∏–µ
            "barrier",  # –ë–∞—Ä—å–µ—Ä—ã
            "stun", "stagger"  # –ï—Å–ª–∏ —Å—Ç–∞–≥–≥–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–æ–º
        ]

        for st in temp_stats:
            if unit.get_status(st) > 0:
                unit.remove_status(st)  # –£–¥–∞–ª—è–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é

        return logs